<!doctype html>
<html class="no-js" lang="zxx">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Fitness App | Workout Tracker</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename='img/favicon.ico') }}">

    <!-- CSS here -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/owl.carousel.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/slicknav.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/animate.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/magnific-popup.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fontawesome-all.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/themify-icons.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/slick.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/nice-select.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- React CDN -->
    <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    
    <style>
        .workout-card {
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        .workout-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .time-input {
            max-width: 100px;
            display: inline-block;
        }
        .chart-container {
            position: relative;
            height: 250px;
            width: 250px;
            margin: 0 auto;
        }
        .workout-summary {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
        }
        .date-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .workout-image {
            height: 150px;
            object-fit: cover;
            width: 100%;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <!--? Preloader Start -->
    <div id="preloader-active">
        <div class="preloader d-flex align-items-center justify-content-center">
            <div class="preloader-inner position-relative">
                <div class="preloader-circle"></div>
            </div>
        </div>
    </div>
    <!-- Preloader Start -->
    
    <header>
        <!-- Header Start -->
        <div class="header-area header-transparent">
            <div class="main-header header-sticky">
                <div class="container-fluid">
                    <div class="menu-wrapper d-flex align-items-center justify-content-between">
                        <!-- Logo -->
                        
                        <!-- Main-menu -->
                        <div class="main-menu f-right d-none d-lg-block">
                            <nav>
                                <ul id="navigation">
                                    <li><a href="{{ url_for('home') }}">Home</a></li>
                                    <li><a href="{{ url_for('about') }}">About</a></li>
                                    <li><a href="{{ url_for('courses') }}">Courses</a></li>
                                    <li><a href="{{ url_for('pricing') }}">Pricing</a></li>
                                    <li class="active"><a href="{{ url_for('tracking') }}">Tracker</a>
                                        <ul class="submenu">
                                            <li><a href="{{ url_for('sleep') }}">Sleep Analysis</a></li>
                                            <li><a href="{{ url_for('diet') }}">Diet Tracker</a></li>
                                            <li><a href="{{ url_for('workout') }}">Workout Plans</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="{{ url_for('contact') }}">Contact</a></li>
                                </ul>
                            </nav>
                        </div>          
                        <!-- Header-btn -->
                        <div class="header-btns d-none d-lg-block f-right">
                            {% if 'user' in session %}
                                <a href="{{ url_for('logout') }}" class="btn">Logout</a>
                            {% else %}
                                <a href="{{ url_for('login') }}" class="btn">Login</a>
                            {% endif %}
                        </div>
                       <!-- Mobile Menu -->
                       <div class="col-12">
                        <div class="mobile_menu d-block d-lg-none"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Header End -->
    </header>
    
    <main>
        <!--? Hero Start -->
        <div class="slider-area2">
            <div class="slider-height2 d-flex align-items-center">
                <div class="container">
                    <div class="row">
                        <div class="col-xl-12">
                            <div class="hero-cap hero-cap2 pt-70">
                                <h2>Workout Tracker</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Hero End -->
        
        <!-- Workout Tracker Section -->
        <section class="sample-text-area">
            <div class="container box_1170">
                <div id="workout-tracker-app"></div>
            </div>
        </section>
    </main>
    
    <footer>
        <!--? Footer Start-->
    <div class="footer-area black-bg">
        <div class="container">
            <div class="footer-top footer-padding">
                <!-- Footer Menu -->
                <div class="row">
                    <div class="col-xl-12">
                        <div class="single-footer-caption mb-50 text-center">
                            <!-- logo -->
                            
                            <!-- Menu -->
                            <!-- Header Start -->
                            <div class="header-area main-header2 wow fadeInUp" data-wow-duration="2s" data-wow-delay=".4s">
                                <div class="main-header main-header2">
                                    <div class="menu-wrapper menu-wrapper2">
                                        <!-- Main-menu -->
                                        <div class="main-menu main-menu2 text-center">
                                            <nav>
                                                <ul>
                                                    <li><a href="index.html">Home</a></li>
                                                    <li><a href="about.html">About</a></li>
                                                    <li><a href="courses.html">Courses</a></li>
                                                    <li><a href="pricing.html">Pricing</a></li>
                                                    <li><a href="gallery.html">Gallery</a></li>
                                                    <li><a href="contact.html">Contact</a></li>
                                                </ul>
                                            </nav>
                                        </div>   
                                    </div>
                                </div>
                            </div>
                            <!-- Header End -->
                            <!-- social -->
                            <div class="footer-social mt-30 wow fadeInUp" data-wow-duration="3s" data-wow-delay=".8s">
                                <a href="#"><i class="fab fa-twitter"></i></a>
                                <a href="https://bit.ly/sai4ull"><i class="fab fa-facebook-f"></i></a>
                                <a href="#"><i class="fab fa-pinterest-p"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Footer Bottom -->
            
      <!-- Footer End-->
  </footer>
    
    <!-- Scroll Up -->
    <div id="back-top">
        <a title="Go to Top" href="#"> <i class="fas fa-level-up-alt"></i></a>
    </div>

    <!-- JS here -->
    <script src="{{ url_for('static', filename='js/vendor/modernizr-3.5.0.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/vendor/jquery-1.12.4.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/popper.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.slicknav.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/owl.carousel.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/slick.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/wow.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/animated.headline.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.nice-select.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.sticky.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.magnific-popup.js') }}"></script>
    <script src="{{ url_for('static', filename='js/contact.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.form.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.validate.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/mail-script.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.ajaxchimp.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/plugins.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    <!-- React Workout Tracker App -->
    <script type="text/babel">
        {% raw %}
        function WorkoutPieChart({ workouts }) {
            const chartRef = React.useRef(null);
            const chartInstance = React.useRef(null);
            
            React.useEffect(() => {
                if (chartRef.current) {
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }
                    
                    const ctx = chartRef.current.getContext('2d');
                    
                    // Prepare data for chart
                    const labels = workouts.map(w => w.workout_name);
                    const data = workouts.map(w => w.calories);
                    const backgroundColors = [
                        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
                        '#FF9F40', '#8AC249', '#EA5F89', '#00BFFF', '#FFD700'
                    ];
                    
                    chartInstance.current = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: labels,
                            datasets: [{
                                data: data,
                                backgroundColor: backgroundColors,
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right'
                                }
                            }
                        }
                    });
                }
                
                return () => {
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }
                };
            }, [workouts]);
            
            return <canvas ref={chartRef} />;
        }
        
        function WorkoutPlan({ workout, onAddWorkout }) {
            const [duration, setDuration] = React.useState(30);
            const [expanded, setExpanded] = React.useState(false);
            
            const handleAddWorkout = () => {
                const calories = Math.round(duration * workout.calories_per_min);
                onAddWorkout(workout.id, workout.name, duration, calories);
                setDuration(30);
            };
            
            return (
                <div className="card workout-card mb-3">
                    <div className="card-header d-flex justify-content-between align-items-center" 
                         onClick={() => setExpanded(!expanded)}>
                        <h5 className="mb-0">{workout.name}</h5>
                        <i className={`fas fa-chevron-${expanded ? 'up' : 'down'}`}></i>
                    </div>
                    {expanded && (
                        <div className="card-body">
                            <div className="row">
                                <div className="col-md-4">
                                    <img 
                                        src={`/static/img/workouts/${workout.image}`}
                                        className="workout-image mb-3"
                                        alt={workout.name}
                                        onError={(e) => {
                                            e.target.onerror = null;
                                            e.target.src = '/static/img/placeholder.jpg';
                                        }}
                                    />
                                </div>
                                <div className="col-md-4">
                                    <div className="workout-summary">
                                        <h6>Workout Details</h6>
                                        <p><strong>Calories Burn:</strong> {workout.calories_per_min} kcal/min</p>
                                        <div className="form-group mt-3">
                                            <label>Duration (minutes):</label>
                                            <input 
                                                type="number" 
                                                className="form-control time-input"
                                                value={duration}
                                                onChange={(e) => setDuration(Math.max(1, e.target.value))}
                                                min="1"
                                            />
                                        </div>
                                    </div>
                                </div>
                                <div className="col-md-4 d-flex align-items-center justify-content-center">
                                    <button 
                                        className="btn btn-primary btn-lg"
                                        onClick={handleAddWorkout}
                                    >
                                        Add Workout
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }
    
        function WorkoutEntry({ entry, onRemove }) {
            return (
                <tr>
                    <td>{entry.workout_name}</td>
                    <td>{entry.duration} mins</td>
                    <td>{entry.calories} kcal</td>
                    <td>
                        <button 
                            className="btn btn-sm btn-danger"
                            onClick={() => onRemove(entry.id)}
                        >
                            <i className="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            );
        }
    
        function WorkoutTracker() {
            const [workouts, setWorkouts] = React.useState([]);
            const [workoutEntries, setWorkoutEntries] = React.useState([]);
            const [currentDate, setCurrentDate] = React.useState(new Date().toISOString().split('T')[0]);
            const [isLoading, setIsLoading] = React.useState(false);
            const [message, setMessage] = React.useState(null);
            
            const fetchWorkoutPlans = async () => {
                setIsLoading(true);
                try {
                    const response = await fetch('/api/workouts');
                    const data = await response.json();
                    if (data.success) {
                        setWorkouts(data.workouts);
                    } else {
                        setMessage({text: data.message || 'Failed to fetch workout plans', type: 'error'});
                    }
                } catch (error) {
                    setMessage({text: 'Failed to fetch workout plans: ' + error.message, type: 'error'});
                } finally {
                    setIsLoading(false);
                }
            };
            
            const fetchWorkoutData = async () => {
                setIsLoading(true);
                try {
                    const response = await fetch(`/api/workout?date=${currentDate}`, {
                        credentials: 'include'
                    });
                    const data = await response.json();
                    if (data.success) {
                        setWorkoutEntries(data.data);
                    } else {
                        setMessage({text: data.message || 'Failed to fetch workout data', type: 'error'});
                    }
                } catch (error) {
                    setMessage({text: 'Failed to fetch workout data: ' + error.message, type: 'error'});
                } finally {
                    setIsLoading(false);
                }
            };
            
            const addWorkout = async (workoutId, workoutName, duration, calories) => {
                setIsLoading(true);
                try {
                    const response = await fetch('/api/workout', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        credentials: 'include',
                        body: JSON.stringify({
                            workout_id: workoutId,
                            workout_name: workoutName,
                            duration: duration,
                            calories: calories,
                            date: currentDate
                        })
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        setMessage({text: 'Workout added successfully!', type: 'success'});
                        fetchWorkoutData();
                    } else {
                        setMessage({text: data.message || 'Failed to add workout', type: 'error'});
                    }
                } catch (error) {
                    setMessage({text: 'Failed to add workout: ' + error.message, type: 'error'});
                } finally {
                    setIsLoading(false);
                }
            };
            
            const removeWorkout = async (id) => {
                setIsLoading(true);
                try {
                    const response = await fetch(`/api/workout/${id}`, {
                        method: 'DELETE',
                        credentials: 'include'
                    });
                    
                    const data = await response.json();
                    if (data.success) {
                        setMessage({text: 'Workout removed successfully', type: 'success'});
                        fetchWorkoutData();
                    } else {
                        setMessage({text: data.message || 'Failed to remove workout', type: 'error'});
                    }
                } catch (error) {
                    setMessage({text: 'Failed to remove workout: ' + error.message, type: 'error'});
                } finally {
                    setIsLoading(false);
                }
            };
            
            const navigateDate = (days) => {
                const date = new Date(currentDate);
                date.setDate(date.getDate() + days);
                setCurrentDate(date.toISOString().split('T')[0]);
            };
            
            React.useEffect(() => {
                fetchWorkoutPlans();
                fetchWorkoutData();
            }, [currentDate]);
            
            const getTotalCalories = () => {
                return workoutEntries.reduce((total, entry) => {
                    return total + (parseFloat(entry.calories) || 0);
                }, 0);
            };
            
            const totalCalories = getTotalCalories();
            
            return (
                <div className="workout-tracker-container">
                    <div className="date-navigation mb-4">
                        <button 
                            className="btn btn-secondary"
                            onClick={() => navigateDate(-1)}
                        >
                            <i className="fas fa-chevron-left"></i> Previous Day
                        </button>
                        <h4 className="d-inline-block mx-3">{new Date(currentDate).toDateString()}</h4>
                        <button 
                            className="btn btn-secondary"
                            onClick={() => navigateDate(1)}
                            disabled={currentDate >= new Date().toISOString().split('T')[0]}
                        >
                            Next Day <i className="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    
                    {message && (
                        <div className={`alert alert-${message.type === 'error' ? 'danger' : message.type === 'success' ? 'success' : 'warning'}`}>
                            {message.text}
                            <button 
                                type="button" 
                                className="close" 
                                onClick={() => setMessage(null)}
                                style={{float: 'right'}}
                            >
                                <span>&times;</span>
                            </button>
                        </div>
                    )}
                    
                    <div className="row">
                        <div className="col-md-8">
                            <h4 className="mb-3">Available Workouts</h4>
                            {isLoading && workouts.length === 0 ? (
                                <div className="text-center py-4">
                                    <div className="spinner-border text-primary" role="status">
                                        <span className="sr-only">Loading...</span>
                                    </div>
                                </div>
                            ) : (
                                <div className="workouts-list">
                                    {workouts.map(workout => (
                                        <WorkoutPlan 
                                            key={workout.id} 
                                            workout={workout} 
                                            onAddWorkout={addWorkout}
                                        />
                                    ))}
                                </div>
                            )}
                        </div>
                        
                        <div className="col-md-4">
                            <div className="card mb-4">
                                <div className="card-body">
                                    <h5 className="card-title">Daily Summary</h5>
                                    <div className="chart-container" style={{height: '250px'}}>
                                        <WorkoutPieChart workouts={workoutEntries} />
                                    </div>
                                    <div className="workout-summary mt-3 text-center">
                                        <h4>Total Calories Burned</h4>
                                        <h2 className="text-primary">{totalCalories} kcal</h2>
                                    </div>
                                </div>
                            </div>
                            
                            <h5 className="mb-3">Today's Workouts</h5>
                            {workoutEntries.length > 0 ? (
                                <div className="table-responsive">
                                    <table className="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Workout</th>
                                                <th>Duration</th>
                                                <th>Calories</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {workoutEntries.map(entry => (
                                                <WorkoutEntry 
                                                    key={entry.id} 
                                                    entry={entry} 
                                                    onRemove={removeWorkout}
                                                />
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            ) : (
                                <div className="alert alert-info">
                                    No workouts recorded for this day. Add workouts to track your progress.
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }
        
        ReactDOM.render(<WorkoutTracker />, document.getElementById('workout-tracker-app'));
        {% endraw %}
    </script>
</body>
</html>